<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Engraving Preview â€” LPWW</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
@font-face { font-family:"ScriptFont1"; src:url("longtail.ttf"); }
@font-face { font-family:"ScriptFont2"; src:url("brittany-signature-script.regular.ttf"); }
@font-face { font-family:"SerifFont"; src:url("kugile.regular.ttf"); }
@font-face { font-family:"SansSerif1"; src:url("mochademo.mocha-demo.ttf"); }
@font-face { font-family:"SansSerif2"; src:url("Berista.ttf"); }
@font-face { font-family:"MainFont"; src:url("BebasNeue-Regular.ttf"); }

body {
  font-family: "MainFont";
  background:#222;
  display:flex;
  justify-content:center;
  margin:0;
}

.container { max-width:900px; width:100%; }

.preview-area { position:relative; margin-top:20px; }
.image-wrapper img { width:100%; display:block; }

.overlay {
  position:absolute;
  color:black;
  text-align:right;
  pointer-events:none;
}

.svg-overlay {
  position:absolute;
  inset:0;
  pointer-events:none;
}
</style>
</head>

<body>
<div class="container">

<input id="textInput" placeholder="Engraving text" oninput="updatePreview()" />

<select id="fontSelect" onchange="updatePreview()">
  <option value="ScriptFont1">Script Font 1</option>
  <option value="ScriptFont2">Script Font 2</option>
  <option value="SerifFont">Serif Font</option>
  <option value="SansSerif1">Sans Serif 1</option>
  <option value="SansSerif2">Sans Serif 2</option>
</select>

<select id="sizeSelect" onchange="updatePreview()">
  <option value="small">Small</option>
  <option value="medium" selected>Medium</option>
  <option value="large">Large</option>
</select>

<div class="preview-area" id="previewArea">
  <div class="image-wrapper">
    <img id="productImage">
    <div id="overlayText" class="overlay"></div>
    <svg id="svgOverlay" class="svg-overlay"></svg>
  </div>
</div>

</div>

<script>
const FONT_SETTINGS = {
  ScriptFont1:{ small:60, medium:70, large:80, bottom:"18%", right:"12%" },
  ScriptFont2:{ small:50, medium:60, large:70, bottom:"16%", right:"12%" },
  SerifFont:{ small:40, medium:50, large:60, bottom:"10%", right:"12%" },
  SansSerif1:{ small:50, medium:60, large:70, bottom:"16%", right:"12%" },
  SansSerif2:{ small:45, medium:55, large:65, bottom:"16%", right:"12%" }
};

const CIRCLE_FONT_SETTINGS = {
  ScriptFont1:{ small:60, medium:70, large:80 },
  ScriptFont2:{ small:50, medium:60, large:70 },
  SerifFont:{ small:40, medium:50, large:60 },
  SansSerif1:{ small:50, medium:60, large:70 },
  SansSerif2:{ small:45, medium:55, large:65 }
};

const images = {
  "R0001":"Engaving crop test 1.png",
  "C0001":"circle-board.png"
};

const overlayText = document.getElementById("overlayText");
const svgOverlay = document.getElementById("svgOverlay");
const productImage = document.getElementById("productImage");

const textInput = document.getElementById("textInput");
const fontSelect = document.getElementById("fontSelect");
const sizeSelect = document.getElementById("sizeSelect");

const id = new URLSearchParams(location.search).get("id") || "R0001";
const isCircle = id.startsWith("C");
productImage.src = images[id];

productImage.onload = updatePreview;

function updatePreview(){
  if(!isCircle){
    svgOverlay.innerHTML="";
    overlayText.style.display="block";
    const cfg = FONT_SETTINGS[fontSelect.value];
    overlayText.textContent = textInput.value;
    overlayText.style.fontFamily = fontSelect.value;
    overlayText.style.fontSize = cfg[sizeSelect.value]+"px";
    overlayText.style.bottom = cfg.bottom;
    overlayText.style.right = cfg.right;
    return;
  }
  overlayText.style.display="none";
  renderCurvedText();
}

function renderCurvedText(){
  svgOverlay.innerHTML="";
  const w = productImage.clientWidth;
  const h = productImage.clientHeight;
  svgOverlay.setAttribute("viewBox",`0 0 ${w} ${h}`);

  // ðŸ”§ MAIN CONTROLS â€” CHANGE THESE
  const MID_ANGLE_DEG = 315;   // rotation (Q4)
  const BASE_RADIUS   = 420;   // BIGGER = closer to edge
  const OFFSET_X      = 0;     // move right (+)
  const OFFSET_Y      = 0;     // move down (+)

  const font = fontSelect.value;
  const size = sizeSelect.value;
  const fontSize = CIRCLE_FONT_SETTINGS[font][size];

  const cx = w/2 + OFFSET_X;
  const cy = h/2 + OFFSET_Y;

  const mid = MID_ANGLE_DEG * Math.PI/180;
  const arc = Math.min(Math.PI*1.3, (textInput.value.length * fontSize * 0.6)/BASE_RADIUS);

  const start = mid - arc/2;
  const end   = mid + arc/2;

  const sx = cx + BASE_RADIUS * Math.cos(start);
  const sy = cy + BASE_RADIUS * Math.sin(start);
  const ex = cx + BASE_RADIUS * Math.cos(end);
  const ey = cy + BASE_RADIUS * Math.sin(end);

  const path = document.createElementNS("http://www.w3.org/2000/svg","path");
  path.setAttribute("d",`M ${sx} ${sy} A ${BASE_RADIUS} ${BASE_RADIUS} 0 0 0 ${ex} ${ey}`);
  path.setAttribute("id","arc");

  const text = document.createElementNS("http://www.w3.org/2000/svg","text");
  text.setAttribute("font-family",font);
  text.setAttribute("font-size",fontSize);
  text.setAttribute("fill","black");

  const tp = document.createElementNS("http://www.w3.org/2000/svg","textPath");
  tp.setAttributeNS("http://www.w3.org/1999/xlink","href","#arc");
  tp.setAttribute("startOffset","50%");
  tp.setAttribute("text-anchor","middle");
  tp.textContent = textInput.value;

  text.appendChild(tp);
  svgOverlay.appendChild(path);
  svgOverlay.appendChild(text);
}
</script>
</body>
</html>
