<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Engraving Preview — LPWW</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <!-- html2canvas (for screenshot) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    /* FONTS */
    @font-face { font-family: "ScriptFont1"; src: url("longtail.ttf") format("truetype"); }
    @font-face { font-family: "ScriptFont2"; src: url("brittany-signature-script.regular.ttf") format("truetype"); }
    @font-face { font-family: "SerifFont"; src: url("kugile.regular.ttf") format("truetype"); }
    @font-face { font-family: "SansSerif1"; src: url("mochademo.mocha-demo.ttf") format("truetype"); }
    @font-face { font-family: "SansSerif2"; src: url("Berista.ttf") format("truetype"); }
    @font-face { font-family: "MainFont"; src: url("BebasNeue-Regular.ttf") format("truetype"); }

    body {
      font-family: "MainFont", system-ui, sans-serif;
      margin: 1px;
      display: flex;
      justify-content: center;
      background: #222222;
      color: #222222;
    }

    .container { width: 100%; max-width: 900px; }

    h1 {
      font-size: 50px;
      margin-bottom: 20px;
      color: #da9a00;
    }

    label {
      font-weight: 600;
      display: block;
      margin-bottom: 6px;
      font-size: 18pt;
      color: #da9a00;
    }

    input[type="text"], select, textarea {
      width: 100%;
      padding: 12px;
      font-size: 18px;
      border-radius: 6px;
      border: none;
      margin-bottom: 20px;
      font-family: inherit;
      color: #222222;
      box-sizing: border-box;
    }

    textarea {
      resize: vertical;
      min-height: 90px;
      margin-top: 30px; /* EXTRA SPACE ABOVE NOTES */
    }

    /* PREVIEW AREA */
    .preview-area {
      margin-top: 25px;
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      background: #222222;
    }

    .image-wrapper img {
      width: 100%;
      display: block;
    }

    .overlay {
      position: absolute;
      color: black;
      white-space: pre-wrap;
      word-break: break-word;
      text-align: right;
      pointer-events: none;
    }

    /* SUBMIT BUTTON */
    #submitBtn {
      background: #da9a00;
      color: #222222;
      border: none;
      padding: 14px 26px;
      font-size: 20px;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      font-family: "MainFont"; /* Bebas Neue */
      font-weight: bold;
    }

    #submitBtn:hover {
      filter: brightness(1.15);
    }
  </style>
</head>

<body>
<div class="container">

  <h1>Engraving Preview Form</h1>

  <!-- TEXT INPUT -->
  <label for="textInput">1. Enter the text you want engraved</label>
  <input id="textInput" type="text" placeholder="Type engraving text here…" oninput="updatePreview()" />

  <!-- FONT SELECT -->
  <label for="fontSelect">2. Choose a font</label>
  <select id="fontSelect" onchange="updateFontSettings()">
    <option value="ScriptFont1">Script Font 1</option>
    <option value="ScriptFont2">Script Font 2</option>
    <option value="SerifFont">Serif Font</option>
    <option value="SansSerif1">Sans Serif Font 1</option>
    <option value="SansSerif2">Sans Serif Font 2</option>
  </select>

  <!-- SIZE SELECT -->
  <label for="sizeSelect">3. Select font size</label>
  <select id="sizeSelect" onchange="updatePreview()">
    <option value="small">Small (40pt)</option>
    <option value="medium" selected>Medium (50pt)</option>
    <option value="large">Large (60pt)</option>
  </select>

  <!-- PREVIEW -->
  <div class="preview-area" id="previewArea">
    <div class="image-wrapper">
      <img id="productImage" src="" alt="Board preview">
      <div id="overlayText" class="overlay">Your text</div>
    </div>
  </div>

  <!-- NOTES -->
  <label for="notesBox">Additional notes for Lucky Penny (optional)</label>
  <textarea id="notesBox" placeholder="Write any custom instructions here..."></textarea>

  <!-- SUBMIT -->
  <button id="submitBtn" onclick="sendEmail()">Submit</button>

</div>

<script>
/* ---------------------------------------------
   CONFIG BLOCK — CUSTOMIZE FONT SIZE & POSITION
---------------------------------------------- */
const FONT_SETTINGS = {
  ScriptFont1: { small: 60, medium: 70, large: 80, bottom: "18%", right: "12%" },
  ScriptFont2: { small: 50, medium: 60, large: 70, bottom: "16%", right: "12%" },
  SerifFont:   { small: 40, medium: 50, large: 60, bottom: "10%", right: "12%" },
  SansSerif1:  { small: 50, medium: 60, large: 70, bottom: "16%", right: "12%" },
  SansSerif2:  { small: 45, medium: 55, large: 65, bottom: "16%", right: "12%" }
};

/* ---------------------------------------------
   MAIN ELEMENTS
---------------------------------------------- */
const overlayText = document.getElementById("overlayText");
const textInput = document.getElementById("textInput");
const fontSelect = document.getElementById("fontSelect");
const sizeSelect = document.getElementById("sizeSelect");

/* IMAGE MAP */
const images = {
  "0001": "Engaving crop test 1.png",
  "0002": "Engaving crop test 2.png",
  "0003": "Engaving crop test 3.png",
  "0004": "Engaving crop test 4.png"
};

/* GET BOARD ID */
function getQueryParam(name) {
  return new URLSearchParams(window.location.search).get(name);
}

/* APPLY FONT SETTINGS */
function updateFontSettings() {
  const font = fontSelect.value;
  const sizeName = sizeSelect.value;
  const config = FONT_SETTINGS[font];

  overlayText.style.fontFamily = font;
  overlayText.style.fontSize = config[sizeName] + "px";
  overlayText.style.bottom = config.bottom;
  overlayText.style.right = config.right;

  updatePreview();
}

/* UPDATE TEXT PREVIEW */
function updatePreview() {
  const font = fontSelect.value;
  const sizeName = sizeSelect.value;
  const config = FONT_SETTINGS[font];

  overlayText.textContent = textInput.value || " ";
  overlayText.style.fontFamily = font;
  overlayText.style.fontSize = config[sizeName] + "px";
  overlayText.style.bottom = config.bottom;
  overlayText.style.right = config.right;
}

/* LOAD BOARD IMAGE */
window.addEventListener("load", () => {
  const id = getQueryParam("id");
  document.getElementById("productImage").src =
    id && images[id] ? images[id] : "https://via.placeholder.com/600x400?text=Board+Preview";

  updateFontSettings();
});

/* ---------------------------------------------
   EMAILJS — SEND EMAIL WITH SCREENSHOT
---------------------------------------------- */
emailjs.init("VQEb26gwHkvgcRIDg");

function sendEmail() {
  const previewArea = document.getElementById("previewArea");

  html2canvas(previewArea).then(canvas => {
    const imgData = canvas.toDataURL("image/png");

    const templateParams = {
      engraving_text: textInput.value,
      font: fontSelect.value,
      size_label: sizeSelect.value,
      notes: document.getElementById("notesBox").value,
      board_id: getQueryParam("id") || "none",
      screenshot: imgData
    };

    emailjs.send("service_lk91mlq", "template_n1bl34p", templateParams)
      .then(() => alert("Your engraving request has been sent!"))
      .catch(err => alert("Error sending email: " + JSON.stringify(err)));
  });
}
</script>
</body>
</html>
