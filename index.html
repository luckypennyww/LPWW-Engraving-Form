<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Engraving Preview â€” LPWW</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<style>
@font-face { font-family:"ScriptFont1"; src:url("longtail.ttf"); }
@font-face { font-family:"ScriptFont2"; src:url("brittany-signature-script.regular.ttf"); }
@font-face { font-family:"SerifFont"; src:url("kugile.regular.ttf"); }
@font-face { font-family:"SansSerif1"; src:url("mochademo.mocha-demo.ttf"); }
@font-face { font-family:"SansSerif2"; src:url("Berista.ttf"); }
@font-face { font-family:"MainFont"; src:url("BebasNeue-Regular.ttf"); }

body {
  font-family:"MainFont", system-ui, sans-serif;
  background:#222;
  margin:0;
  display:flex;
  justify-content:center;
}

.container { max-width:900px; width:100%; padding:20px; }

h1 { color:#da9a00; font-size:48px; }

label { color:#da9a00; font-size:18pt; display:block; margin-bottom:6px; }

input, select {
  width:100%;
  padding:12px;
  margin-bottom:20px;
  font-size:18px;
  border-radius:6px;
  border:none;
}

.preview-area {
  position:relative;
  margin-top:20px;
}

.image-wrapper img { width:100%; display:block; }

.overlay {
  position:absolute;
  right:12%;
  bottom:16%;
  color:black;
  text-align:right;
  white-space:pre-wrap;
  pointer-events:none;
}

.svg-overlay {
  position:absolute;
  inset:0;
  pointer-events:none;
}
</style>
</head>

<body>
<div class="container">

<h1>Engraving Preview</h1>

<label>Text</label>
<input id="textInput" oninput="updatePreview()" />

<label>Font</label>
<select id="fontSelect" onchange="updatePreview()">
  <option value="ScriptFont1">Script Font 1</option>
  <option value="ScriptFont2">Script Font 2</option>
  <option value="SerifFont">Serif Font</option>
  <option value="SansSerif1">Sans Serif 1</option>
  <option value="SansSerif2">Sans Serif 2</option>
</select>

<label>Size</label>
<select id="sizeSelect" onchange="updatePreview()">
  <option value="small">Small</option>
  <option value="medium" selected>Medium</option>
  <option value="large">Large</option>
</select>

<div class="preview-area">
  <div class="image-wrapper">
    <img id="productImage">
    <div id="overlayText" class="overlay"></div>
    <svg id="svgOverlay" class="svg-overlay"></svg>
  </div>
</div>

<!-- Submit form -->
<form id="submitForm" style="margin-top:20px;">
  <label>Email:</label>
  <input type="email" id="userEmail" required placeholder="Enter your email">
  <button type="submit" style="
      background:#da9a00; color:#222; padding:12px 24px; font-size:18px;
      border:none; border-radius:6px; cursor:pointer;">Submit</button>
</form>

</div>

<script>
/***** ðŸ”´ CIRCULAR TEXT TUNING â€” EDIT THESE ONLY ðŸ”´ *****/
const CIRCLE_TUNING = {
  radius: 420,
  angleDeg: 180, // center pointing left for bottom-right
  offsetX: 0,
  offsetY: 0
};
/***** ðŸ”´ END CIRCULAR TUNING ðŸ”´ *****/

const FONT_SETTINGS = {
  ScriptFont1:{ small:60, medium:70, large:80, bottom:"18%", right:"12%" },
  ScriptFont2:{ small:50, medium:60, large:70, bottom:"16%", right:"12%" },
  SerifFont:{ small:40, medium:50, large:60, bottom:"10%", right:"12%" },
  SansSerif1:{ small:50, medium:60, large:70, bottom:"16%", right:"12%" },
  SansSerif2:{ small:45, medium:55, large:65, bottom:"16%", right:"12%" }
};

const images = {
  "R0001":"Engraving board 1.png",
  "C0001":"Engaving crop test 5.png"
};

const textInput = document.getElementById("textInput");
const fontSelect = document.getElementById("fontSelect");
const sizeSelect = document.getElementById("sizeSelect");
const overlayText = document.getElementById("overlayText");
const svgOverlay = document.getElementById("svgOverlay");
const productImage = document.getElementById("productImage");

const id = new URLSearchParams(location.search).get("id");
const isCircle = id && id.startsWith("C");

productImage.src = images[id] || "";

function updatePreview() {
  const font = fontSelect.value;
  const size = sizeSelect.value;
  const text = textInput.value || "";

  if (!isCircle) {
    overlayText.style.display = "block";
    svgOverlay.innerHTML = "";
    const cfg = FONT_SETTINGS[font];
    overlayText.textContent = text;
    overlayText.style.fontFamily = font;
    overlayText.style.fontSize = cfg[size] + "px";
    overlayText.style.bottom = cfg.bottom;
    overlayText.style.right = cfg.right;
    return;
  }

  overlayText.style.display = "none";
  svgOverlay.innerHTML = "";

  // Ensure image is loaded
  if (!productImage.complete || productImage.naturalWidth === 0) {
    productImage.onload = updatePreview;
    return;
  }

  const cfg = FONT_SETTINGS[font];
  const fontSize = cfg[size];
  const radius = CIRCLE_TUNING.radius;

  // Anchor bottom-right in pixels
  const rightPx = productImage.clientWidth * parseFloat(cfg.right) / 100;
  const bottomPx = productImage.clientHeight * parseFloat(cfg.bottom) / 100;

  // Circle center for bottom-right arc
  const cx = productImage.clientWidth - rightPx + CIRCLE_TUNING.offsetX;
  const cy = productImage.clientHeight - bottomPx + CIRCLE_TUNING.offsetY;

  const mid = CIRCLE_TUNING.angleDeg * Math.PI / 180;
  const arc = Math.min(Math.PI, (text.length * fontSize * 0.6) / radius);

  const start = mid - arc/2;
  const end = mid + arc/2;

  // Flip y-axis to curve above bottom
  const sx = cx + radius * Math.cos(start);
  const sy = cy - radius * Math.sin(start);
  const ex = cx + radius * Math.cos(end);
  const ey = cy - radius * Math.sin(end);

  const path = document.createElementNS("http://www.w3.org/2000/svg","path");
  path.setAttribute("id","curve");
  path.setAttribute("d",`M ${sx} ${sy} A ${radius} ${radius} 0 0 0 ${ex} ${ey}`);
  path.setAttribute("fill","none");
  svgOverlay.appendChild(path);

  const textEl = document.createElementNS("http://www.w3.org/2000/svg","text");
  textEl.setAttribute("font-family", font);
  textEl.setAttribute("font-size", fontSize);
  textEl.setAttribute("fill","black");

  const textPath = document.createElementNS("http://www.w3.org/2000/svg","textPath");
  textPath.setAttribute("href", "#curve");
  textPath.setAttribute("startOffset", "50%");
  textPath.setAttribute("text-anchor", "middle");
  textPath.textContent = text;

  textEl.appendChild(textPath);
  svgOverlay.appendChild(textEl);
}

// Submit button email
document.getElementById("submitForm").addEventListener("submit", function(e){
  e.preventDefault();
  const email = document.getElementById("userEmail").value;
  const text = textInput.value;
  const font = fontSelect.value;
  const size = sizeSelect.value;

  const subject = encodeURIComponent("Engraving Order");
  const body = encodeURIComponent(
    `Text: ${text}\nFont: ${font}\nSize: ${size}\nProduct ID: ${id}`
  );

  window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
});

// Initial preview
updatePreview();
</script>
</body>
</html>
